---
title: "Event Loop –≤ –¥–µ—Ç–∞–ª—è—Ö"
tags:
  - javascript
  - frontend
date: 12 Sep 2023
references:
  - name: "Event loop under the hood"
    url: https://dev.to/_staticvoid/node-js-under-the-hood-3-deep-dive-into-the-event-loop-135d
  - name: "Habr: –ë–∞–∑–æ–≤–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø–∞ Event Loop"
    url: https://habr.com/ru/articles/680846/
  - name: "Event loop explainer"
    url: https://github.com/atotic/event-loop
  - name: "Event loop: –º–∏–∫—Ä–æ–∑–∞–¥–∞—á–∏ –∏ –º–∞–∫—Ä–æ–∑–∞–¥–∞—á–∏"
    url: https://frontend-blog-tau.vercel.app/event-loop
---

–í –¥–∞–Ω–Ω–æ–π —Å—Ç–∞—Ç—å–µ –ø–æ–≥–æ–≤–æ—Ä–∏–º –æ —Ç–æ–º, –ø–æ—á–µ–º—É Event Loop –≤–æ–æ–±—â–µ –±—ã–ª —Å–æ–∑–¥–∞–Ω, –∫–∞–∫ —Å –Ω–∏–º —Ä–∞–±–æ—Ç–∞—Ç—å
–∏ –ø–æ—á–µ–º—É –ø—Ä–æ –Ω–µ–≥–æ —Å–ø—Ä–∞—à–∏–≤–∞—é—Ç –Ω–∞ —Å–æ–±–µ—Å–∞—Ö.

JS –±—ã–ª —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω –∫–∞–∫ –æ–¥–Ω–æ–ø–æ—Ç–æ—á–Ω—ã–π —è–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è. –≠—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ –æ–Ω –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å —Ç–æ–ª—å–∫–æ
–æ–¥–Ω—É –æ–ø–µ—Ä–∞—Ü–∏—é –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ. –¢–µ–º –Ω–µ –º–µ–Ω–µ–µ —É JavaScript –µ—Å—Ç—å —Ç–∞–∫–æ–π –º–µ—Ö–∞–Ω–∏–∑–º –∫–∞–∫ Event Loop, –∫–æ—Ç–æ—Ä—ã–π –∫–∞–∫ —Ä–∞–∑ –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç
–≤—ã–ø–æ–ª–Ω—è—Ç—å "–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ" –æ–ø–µ—Ä–∞—Ü–∏–∏. –ü–æ—á–µ–º—É "–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ" –≤ –∫–∞–≤—ã—á–∫–∞—Ö? –î–∞ –ø—Ä–æ—Å—Ç–æ –ø–æ—Ç–æ–º—É —á—Ç–æ JavaScript —Ç–æ–∂–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∏—Ö —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ, –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç–∏ –≤ JavaScript –∫–∞–∫ —Ç–∞–∫–æ–≤–æ–π –Ω–µ—Ç.
–í–ø–µ—Ä–µ–¥ –ø–æ–¥ –∫–∞—Ç, –±—É–¥–µ–º —Ä–∞–∑–±–∏—Ä–∞—Ç—å—Å—è)

# –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥
–° —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º –∫–æ–¥–æ–º –≤—Å–µ –±–æ–ª–µ–µ –∏–ª–∏ –º–µ–Ω–µ–µ —è—Å–Ω–æ: –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä –ø—Ä–æ—Ö–æ–¥–∏—Ç—Å—è –ø–æ –∫–∞–∂–¥–æ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –µ–µ –∏ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç.

```js [sync.js]
let acc = 1;
console.log(acc); // 1

acc++;
console.log(acc); // 2

let anotherAcc = acc;
console.log(anotherAcc, acc); // 3 3
```

::ContentSvg{src="./assets/loop.svg" alt="–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏–π Event Loop"}
::

# –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥
–° –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º –∫–æ–¥–æ–º –≤—Å–µ –Ω–µ–º–Ω–æ–∂–∫–æ —Å–ª–æ–∂–Ω–µ–µ. –†–∞—Å—Å–º–æ—Ç—Ä–∏–º —Å–ª–µ–¥—É—é—â–∏–π –ø—Ä–∏–º–µ—Ä:

```js [async.js]
let acc = 1;
console.log("Call 1:", acc);

acc++;
console.log("Call 2:", acc);

setTimeout(() => {
  acc++;
  console.log("Call 3:", acc);
}, 0);

let anotherAcc = acc;
console.log("Call 4:", anotherAcc, acc);
```

```output
Call 1: 1
Call 2: 2
Call 4: 2 2
Call 3: 3
```

–ö–∞–∫ –º—ã –º–æ–∂–µ–º —É–≤–∏–¥–µ—Ç—å `console.log`, –∫–æ—Ç–æ—Ä—ã–π –±—ã–ª –≤ `setTimeout` –ø–æ—á–µ–º—É-—Ç–æ –≤—ã–ø–æ–ª–Ω–∏–ª—Å—è –ø–æ–∑–∂–µ, –Ω–æ –ø–æ—á–µ–º—É —Ç–∞–∫ —Å–ª—É—á–∏–ª–æ—Å—å?

–¢—É—Ç –≤ —Å–∏–ª—É –∏ –≤—Å—Ç—É–ø–∞–µ—Ç Event Loop. –¢–∞–∫ –∫–∞–∫ `setTimeout` —ç—Ç–æ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è (—Ç–∞–π–º–µ—Ä –≤—ã—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –±—Ä–∞—É–∑–µ—Ä–∞, –∞ –Ω–µ –≤ JS).

## –ü—Ä–æ—Ö–æ–¥–∏–º—Å—è –ø–æ –∫–æ–¥—É –∫–∞–∫ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä
–î–∞–≤–∞–π—Ç–µ —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –≤—Å–µ –±–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω–æ. –ú—ã –æ–±—ä—è–≤–ª—è–µ–º –≤—Å–µ –Ω–∞—à–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ –ø—Ä–æ–¥–µ–ª—ã–≤–∞–µ–º —Å –Ω–∏–º–∏ –∫–∞–∫–∏–µ-—Ç–æ –æ–ø–µ—Ä–∞—Ü–∏–∏. –í—Å–µ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –±—É–¥—É—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –∫–∞–∫ —Ç–æ–ª—å–∫–æ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä –¥–æ–π–¥–µ—Ç –¥–æ –Ω–∏—Ö:

::ContentSvg{src="./assets/event-loop-1.svg" alt="–ö–∞–∫ –≤—ã–≥–ª—è–¥–∏—Ç –æ—á–µ—Ä–µ–¥—å –æ–ø–µ—Ä–∞—Ü–∏–π"}
::

–î—Ä—É–≥–æ–µ –¥–µ–ª–æ –æ–±—Å—Ç–æ–∏—Ç —Å —Ç–∞–π–º–µ—Ä–æ–º, –≤—Ä–µ–º—è –∫–æ—Ç–æ—Ä–æ–µ –æ–∂–∏–¥–∞–µ—Ç —Ç–∞–π–º–∞—É—Ç –±—É–¥–µ—Ç —Å—á–∏—Ç–∞—Ç—å—Å—è –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –±—Ä–∞—É–∑–µ—Ä–∞, –ø–æ—ç—Ç–æ–º—É –æ–ø–µ—Ä–∞—Ü–∏—è –∫–∞–∫ –±—ã "–ø—Ä–æ–ø–∞–¥–µ—Ç" –∏–∑ –æ—á–µ—Ä–µ–¥–∏.
–¢–∞–π–º–µ—Ä –ø–æ–ø–∞–ª –≤ Event Loop, –≥–¥–µ –±—É–¥–µ—Ç –∂–¥–∞—Ç—å –ø–æ–∫—É–¥–∞ –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø—Ä–∏—à–ª–µ—Ç —Å–∏–≥–Ω–∞–ª, –æ —Ç–æ–º —á—Ç–æ –≤—Ä–µ–º—è –¥–ª—è —Ç–∞–π–º–∞—É—Ç–∞ –≤—ã—à–ª–æ –∏ –∫–æ–ª–ª–±—ç–∫ –≤–Ω—É—Ç—Ä–∏ —Ç–∞–π–º–µ—Ä–∞ –º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å.

::ContentSvg{src="./assets/event-loop-2.svg" alt="–¢–∞–π–º–µ—Ä –∏—Å—á–µ–∑–∞–µ—Ç –∏–∑ –æ—á–µ—Ä–µ–¥–∏ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è ü•∏"}
::

–¢–µ–ø–µ—Ä—å —Å–∞–º–æ–µ –Ω–µ–æ—á–µ–≤–∏–¥–Ω–æ–µ: –¥–∞–∂–µ –µ—Å–ª–∏ —Ç–∞–π–º–∞—É—Ç –≤—ã–ø–æ–ª–Ω–∏–ª—Å—è, –∞ —Ñ—É–Ω–∫—Ü–∏—è –≤ –∫–æ—Ç–æ—Ä–æ–π –º—ã –≤—ã–ø–æ–ª–Ω—è–µ–º –≤—Å–µ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –µ—â–µ –Ω–µ –≤—ã–ø–æ–ª–Ω–∏–ª–∞—Å—å, Event Loop –±—É–¥–µ—Ç –¥–µ—Ä–∂–∞—Ç—å –≤—Å–µ —á—Ç–æ –≤ –Ω–µ–º —Å–æ–¥–µ—Ä–∂–∏—Ç—Å—è,
–ø–æ–∫—É–¥–∞ —É –Ω–∞—Å –Ω–µ –æ—á–∏—Å—Ç–∏—Ç—Å—è Call Stack. **–¢–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –≤—Å–µ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ —Ñ—É–Ω–∫—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω–∏–ª–∏—Å—å** Event Loop –æ—Ç–¥–∞—Å—Ç –Ω–∞–º –Ω–∞—à —Ç–∞–π–º–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –º—ã —Å–º–æ–∂–µ–º –≤—ã–ø–æ–ª–Ω–∏—Ç—å:

::ContentSvg{src="./assets/event-loop-3.svg" alt="–í—Å–µ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å, —Ç–∞–π–º–µ—Ä –æ—Ç—Ä–∞–±–æ—Ç–∞–ª –∏ —Ç–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ —á—Ç–æ-—Ç–æ –≤—ã–≤–æ–¥–∏—Ç—å"}
::

# –õ–µ–∑–µ–º –≤ –¥–µ–±—Ä–∏

–ö–∞–∫ —É–∂–µ –±—ã–ª–æ —Å–∫–∞–∑–∞–Ω–æ –≤—ã—à–µ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä –≤ JavaScript –≤—ã–ø–æ–ª–Ω—è–µ—Ç –æ–¥–Ω—É –æ–ø–µ—Ä–∞—Ü–∏—é –∑–∞ —Ä–∞–∑, –≤—Å–µ —á—Ç–æ —è–≤–ª—è–µ—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º –æ–Ω –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ Event Loop.
–û–¥–Ω–∞–∫–æ, –≤—ã –Ω–∞–≤–µ—Ä–Ω–æ–µ –º–æ–≥–ª–∏ —Å–ª—ã—à–∞—Ç—å –æ —Ç–∞–∫–∏—Ö –≤–µ—â–∞—Ö –∫–∞–∫ "–º–∞–∫—Ä–æ—Ç–∞—Å–∫–∏" –∏ "–º–∏–∫—Ä–æ—Ç–∞—Å–∫–∏".

–î–µ–ª–æ –≤ —Ç–æ–º, —á—Ç–æ Event Loop - –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º –≤ JavaScript, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å (—Ö–æ—Ç—è –ø–æ —Å—É—Ç–∏ –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ, –ø—Ä–æ—Å—Ç–æ –æ—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ, –æ–± —ç—Ç–æ–º –¥–∞–ª–µ–µ).
Event Loop —è–≤–ª—è–µ—Ç—Å—è —Å—Ç–µ–∫–æ–º, –≥–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤—Å–µ –∑–∞–¥–∞—á–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –≤–æ—à–ª–∏ –≤ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –ø–æ—Ç–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è. –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞ - –∑–∞–¥–∞—á–∏ –Ω–∞—á–∏–Ω–∞—é—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –∏–∑ Event Loop'–∞.
–û–¥–Ω–∞–∫–æ —É Event Loop'–∞ —Ç–æ–∂–µ –µ—Å—Ç—å —Å–≤–æ–∏ –ø—Ä–∞–≤–∏–ª–∞. –û–Ω –¥–µ–ª–∏—Ç –≤—Å–µ –∑–∞–¥–∞—á–∏ –Ω–∞ –ø–æ–¥—Ç–∏–ø—ã:

- –ú–∏–∫—Ä–æ–∑–∞–¥–∞—á–∏
- –ú–∞–∫—Ä–æ–∑–∞–¥–∞—á–∏
- –ó–∞–¥–∞—á–∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–∏

–ú–∞–∫—Ä–æ–∑–∞–¥–∞—á–∞–º–∏ —è–≤–ª—è—é—Ç—Å—è –≤—Å–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏, —Ç–∞–∫–∏–µ –∫–∞–∫ XmlHTTPRequest, setTimeout –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ.

–í –º–∏–∫—Ä–æ–∑–∞–¥–∞—á–∏ –ø–æ–ø–∞–¥–∞—é—Ç –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Ç–æ–ª—å–∫–æ –¥–≤–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: `then` —É –ø—Ä–æ–º–∏—Å–æ–≤, –∞ —Ç–∞–∫–∂–µ [Intersection Observer](https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API).

–í –∑–∞–¥–∞—á–∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –ø–æ–ø–∞–¥–∞—é—Ç –∑–∞–¥–∞—á–∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –æ—Ç—Ä–∏—Å–æ–≤–∫–æ–π –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã.

–ï—Å–ª–∏ –±—ã –º—ã –¥–µ–ª–∞–ª–∏ —Å–≤–æ–π Event Loop, —Ç–æ –æ–Ω –±—ã –≤—ã–≥–ª—è–¥–µ–ª —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:

```ts [event-loop.ts]
// –ó–∞–¥–∞—á–∞
interface Task {
  execute: () => {},
}

// –†–∞–∑–Ω—ã–µ —Ç–∏–ø—ã –º–∞–∫—Ä–æ–∑–∞–¥–∞—á
interface MacroTasks {
  parser: Task[];
  resources: Task[];
  domManipulation: Task[];
  events: Task[];
  callbacks: Task[];
}

// –¢–∏–ø–∏–∑–∞—Ü–∏—è –¥–ª—è —Å–∞–º–æ–≥–æ Event Loop'–∞
interface EventLoop {
  macrotasks: MacroTasks;
  microtasks: Task[];
  nextMacrotask: () => Task | null;
  needRender: () => boolean;
  render: () => void;
}

// –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è, –∫–æ—Ç–æ—Ä–∞—è –º–µ–Ω—è–µ—Ç—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–æ–≥–æ –µ—Å—Ç—å –ª–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ callstack
let isCallStackEmpty = false;

const eventLoop: EventLoop = {
  macrotasks: {
    parser: [], // –ü–∞—Ä—Å–µ—Ä—ã HTML, CSS, A11y Tree
    resources: [], // –ü–æ–¥–≥—Ä—É–∑–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤
    domManipulation: [], // –ú–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏ —Å DOM
    events: [], // –ò–≤–µ–Ω—Ç—ã UI
    callbacks: [], // –ö–æ–ª–ª–±—ç–∫–∏ –∏–∑ setTimeout –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ
  },

  microtasks: [],

  // –û—Ç–¥–∞–µ—Ç –Ω–∞–º —Å–ª–µ–¥—É—é—â—É—é –∑–∞–¥–∞—á—É –∏–∑ —Å–ø–∏—Å–∫–∞ –º–∞–∫—Ä–æ–∑–∞–¥–∞—á
  nextMacrotask() {
    for (const macrotaskSection in this.macrotasks) {
      const queue = this.macrotasks[macrotaskSection as keyof typeof this.macrotasks];

      if (queue.length) {
        return queue.shift() ?? null;
      }
    }
    return null;
  },

  needRender: () => false,
  render() {}
}

// Event loop –Ω–∞—á–∞–ª —Å–≤–æ—é —Ä–∞–±–æ—Ç—É
while (true) {
  if (!isCallStackEmpty) {
    continue;
  }

  for (const task of eventLoop.microtasks) {
    task.execute();
  }
  eventLoop.microtasks = [];

  const task = eventLoop.nextMacrotask();
  if (task) {
    task.execute();
  }

  if (eventLoop.needRender()) {
    eventLoop.render();
  }
}
```

–°–∞–º–æ–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ –≤ –¥–∞–Ω–Ω–æ–º –∫–æ–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤–Ω–∏–∑—É, –≤–Ω—É—Ç—Ä–∏ —Ü–∏–∫–ª–∞ `while`:

```typescript
// Event loop –Ω–∞—á–∞–ª —Å–≤–æ—é —Ä–∞–±–æ—Ç—É
while (true) {
  if (!isCallStackEmpty) {
    continue;
  }

  for (const task of eventLoop.microtasks) {
    task.execute();
  }
  eventLoop.microtasks = [];

  const task = eventLoop.nextMacrotask();
  if (task) {
    task.execute();
  }

  if (eventLoop.needRender()) {
    eventLoop.render();
  }
}
```

–ú—ã –º–æ–∂–µ–º –Ω–∞–≥–ª—è–¥–Ω–æ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –∫–∞–∫ Event Loop –¥–µ–ª–∞–µ—Ç —Ä–µ—à–µ–Ω–∏—è –æ —Ç–æ–º –∫–∞–∫—É—é –∑–∞–¥–∞—á—É –±—Ä–∞—Ç—å –∏ –≤—ã–ø–æ–ª–Ω—è—Ç—å –ø–µ—Ä–≤–æ–π.

1. –°–Ω–∞—á–∞–ª–∞ Event Loop –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—ã–ø–æ–ª–Ω–∏–ª–∏—Å—å –ª–∏ –≤—Å–µ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏
2. –ü–æ—Ç–æ–º –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è **–≤—Å–µ –∑–∞–¥–∞—á–∏** –∏–∑ –º–∏–∫—Ä–æ—Ç–∞—Å–∫–æ–≤
3. –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –º–∏–∫—Ä–æ—Ç–∞—Å–∫–æ–≤ - –æ—á–µ—Ä–µ–¥—å –æ—á–∏—â–∞–µ—Ç—Å—è
4. –ó–∞—Ç–µ–º –º—ã –±–µ—Ä–µ–º **–æ–¥–Ω—É** –º–∞–∫—Ä–æ–∑–∞–¥–∞—á—É –∏–∑ —Å–ø–∏—Å–∫–∞ –∏ –≤—ã–ø–æ–ª–Ω—è–µ–º –µ–µ
5. –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º—ã —Å–º–æ—Ç—Ä–∏–º –Ω—É–∂–Ω–æ –ª–∏ –Ω–∞–º —Å–¥–µ–ª–∞—Ç—å –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã
6. –ï—Å–ª–∏ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –Ω—É–∂–Ω–æ - –¥–µ–ª–∞–µ–º —ç—Ç–æ
7. –í—Å–µ —Å–Ω–æ–≤–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –ø–µ—Ä–≤–æ–≥–æ –ø—É–Ω–∫—Ç–∞ :)

# –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã ‚ú®
–í–µ—Å—å —ç—Ç–æ—Ç —Ñ–ª–æ—É –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ª–µ–≥–∫–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å. –î–∞–≤–∞–π—Ç–µ –≤–æ–∑—å–º–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–∫—Ä–æ –∏ –º–∞–∫—Ä–æ –æ–ø–µ—Ä–∞—Ü–∏–π –∏ –ø–æ–ø—Ä–æ–±—É–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç—å –∏—Ö

```js
console.log("Step 1: In global scope")

setTimeout(() => console.log("Step 2: In setTimeout"));

new Promise((resolve) => {
  console.log('Step 3: In promise constructor');
}).then(() => console.log('Step 4: In then'));

setTimeout(() => console.log("Step 5: In another setTimeout"))
```

```output
Step 1: In global scope
Step 3: In promise constructor
Step 4: In then
Step 2: In setTimeout
Step 5: In another setTimeout
```

> –ù–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π –Ω–∞–ø–æ–º–Ω—é, —á—Ç–æ –∫–æ–ª–ª–±—ç–∫ –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞ –ø—Ä–æ–º–∏—Å–∞ —è–≤–ª—è–µ—Ç—Å—è **—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º**.

–ö–∞–∫ –º—ã –º–æ–∂–µ–º —É–≤–∏–¥–µ—Ç—å —Ç—É—Ç –≤—Å–µ –≤—ã–≤–æ–¥–∏—Ç—Å—è —Å–æ–≥–ª–∞—Å–Ω–æ –∫–æ–¥—É, –∫–æ—Ç–æ—Ä—ã–π –º—ã —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–ª–∏ –≤—ã—à–µ.

- –°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏–ª–∏—Å—å –≤—Å–µ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏: `Step 1`, `Step 3`;
- –ü–æ—Ç–æ–º –≤—ã–ø–æ–ª–Ω–∏–ª–∏—Å—å –≤—Å–µ –º–∏–∫—Ä–æ—Ç–∞—Å–∫–∏: `Step 4`;
- –ó–∞—Ç–µ–º –≤—ã–ø–æ–ª–Ω–∏–ª–∏—Å—å –≤—Å–µ –º–∞–∫—Ä–æ—Ç–∞—Å–∫–∏: `Step 2`, `Step 5`;

–°–ª–µ–¥—É–µ—Ç –∑–∞–º–µ—Ç–∏—Ç—å —á—Ç–æ –∑–∞–¥–∞—á–∏ –∏–∑ –∫–∞–∂–¥–æ–π –æ—á–µ—Ä–µ–¥–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø—É FIFO (First In, First Out) (–ü–µ—Ä–≤—ã–π –≤–æ—à–µ–ª, –ø–µ—Ä–≤—ã–π –≤—ã—à–µ–ª),
–∏–º–µ–Ω–Ω–æ –ø–æ—ç—Ç–æ–º—É –≤ —Å–ø–∏—Å–∫–µ –º–∞–∫—Ä–æ–∑–∞–¥–∞—á –≤—ã–≤–µ–ª–æ—Å—å `Step 2`, –∞ –∑–∞—Ç–µ–º `Step 5`.

::ContentSvg{src="./assets/steps-1.svg" alt="–®–∞–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è"}
::

## –î–≤–∞ then

–¢–µ–ø–µ—Ä—å –¥–∞–≤–∞–π—Ç–µ –¥–æ–±–∞–≤–∏–º –µ—â–µ –æ–¥–∏–Ω `then` –∫ –Ω–∞—à–µ–º—É –ø—Ä–æ–º–∏—Å—É –∏ –ø–æ—Å–º–æ—Ç—Ä–∏–º —á—Ç–æ —Å–ª—É—á–∏—Ç—Å—è:

```js
console.log("Step 1: In global scope")

setTimeout(() => console.log("Step 2: In setTimeout"));

new Promise((resolve) => {
  console.log('Step 3: In promise constructor');
}).then(() => console.log('Step 4: In then'))
  .then(() => console.log('Step 5: In another then'));

setTimeout(() => console.log("Step 6: In another setTimeout"))

```

```output
Step 1: In global scope
Step 3: In promise constructor
Step 4: In then
Step 5: In another then
Step 2: In setTimeout
Step 6: In another setTimeout
```

–ö–∞–∫ –º—ã –º–æ–∂–µ–º —É–≤–∏–¥–µ—Ç—å, –æ—Å–æ–±–æ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–µ–Ω—è–ª–æ—Å—å. –ü—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤–∏–ª–∞—Å—å –µ—â–µ –æ–¥–Ω–∞ –º–∏–∫—Ä–æ–∑–∞–¥–∞—á–∞,
–≤ —Ü–µ–ª–æ–º —Å–ø–∏—Å–æ–∫ –≤—ã–≤–æ–¥–∏–º—ã—Ö —Å—Ç—Ä–æ–∫ –Ω–∏–∫–∞–∫ –Ω–µ –ø–æ–º–µ–Ω—è–ª—Å—è, –ø—Ä–æ—Å—Ç–æ –ø–æ—Å–ª–µ `Step 4` –¥–æ–±–∞–≤–∏–ª—Å—è `Step 5`.

::ContentSvg{src="./assets/steps-2.svg" alt="–®–∞–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è"}
::

## –î–≤–∞ –ø—Ä–æ–º–∏—Å–∞ —Å –¥–≤—É–º—è then

–¢–µ–ø–µ—Ä—å –¥–∞–≤–∞–π—Ç–µ –ø–æ–ø—Ä–æ–±—É–µ–º –ø—Ä–æ–≤–µ—Ä–Ω—É—Ç—å —Ç–æ –∂–µ, –Ω–æ —É–∂–µ —Å –¥–≤—É–º—è –ø—Ä–æ–º–∏—Å–∞–º–∏:

```js
console.log("Step 1: In global scope")

setTimeout(() => console.log("Step 2: In setTimeout"));

new Promise((resolve) => {
  console.log('Step 3: In promise constructor');
  resolve();
}).then(() => console.log('Step 4: In then'))
  .then(() => console.log('Step 5: In another then'));

setTimeout(() => console.log("Step 6: In another setTimeout"))

new Promise((resolve) => {
  console.log('Step 7: In promise constructor');
  resolve();
}).then(() => console.log('Step 8: In then'))
  .then(() => console.log('Step 9: In another then'));
```

```output
Step 1: In global scope
Step 3: In promise constructor
Step 7: In promise constructor
Step 4: In then
Step 8: In then
Step 5: In another then
Step 9: In another then
Step 2: In setTimeout
Step 6: In another setTimeout
```

–¢—É—Ç —É–∂–µ —á—Ç–æ-—Ç–æ –ø–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–µ–µ, –¥–∞–≤–∞–π—Ç–µ —Ä–∞–∑–±–∏—Ä–∞—Ç—å—Å—è. –í—Å–µ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω–∏–ª–∏—Å—å –ø–µ—Ä–≤—ã–º–∏. –ó–∞—Ç–µ–º –ø–æ–¥—Ç—è–Ω—É–ª–∏—Å—å –º–∏–∫—Ä–æ—Ç–∞—Å–∫–∏, –Ω–æ –Ω–µ –≤ –æ–±—ã—á–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ:
–≤–º–µ—Å—Ç–æ —Ç–æ–≥–æ —á—Ç–æ–±—ã –≤—ã–ø–æ–ª–Ω–∏—Ç—å `console.log` –≤ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ `Step 4`, `Step 5`, `Step 8`, `Step 9`, –æ–Ω –≤—ã–ø–æ–ª–Ω–∏–ª—Å—è –≤ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
`Step 4`, `Step 8`, `Step 5`, `Step 9`. –°–µ–π—á–∞—Å —Ä–∞–∑–±–µ—Ä–µ–º—Å—è –ø–æ—á–µ–º—É —Ç–∞–∫ —Å–ª—É—á–∏–ª–æ—Å—å.

::ContentSvg{src="./assets/steps-3-1.svg" alt="–†–∞–∑–Ω–∏—Ü–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è"}
::

–î–µ–ª–æ –≤ —Ç–æ–º, —á—Ç–æ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä JavaScript –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∫–æ–¥ —à–∞–≥ –∑–∞ —à–∞–≥–æ–º. –û–Ω —É–≤–∏–¥–µ–ª —á—Ç–æ —É –Ω–∞—Å –µ—Å—Ç—å `then` –∏ –ø–æ–º–µ—Å—Ç–∏–ª –∏—Ö –≤ –æ—á–µ—Ä–µ–¥—å –º–∏–∫—Ä–æ–∑–∞–¥–∞—á,
–∫–æ–≥–¥–∞ –ø—Ä–∏—à–ª–∞ –º–∏–∫—Ä–æ–∑–∞–¥–∞—á–∏ –æ—Ç—Ä–∞–±–æ—Ç–∞–ª–∏ - –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä —É–≤–∏–¥–µ–ª –µ—â–µ –æ–¥–∏–Ω `then` –∏ –æ–ø—è—Ç—å –ø–æ–º–µ—Å—Ç–∏–ª –µ–≥–æ –≤ –æ—á–µ—Ä–µ–¥—å –º–∏–∫—Ä–æ–∑–∞–¥–∞—á. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º –≤—Å–µ `then`, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –ø–æ—Å–ª–µ –ø–µ—Ä–≤—ã—Ö `then`
–≤—ã–ø–æ–ª–Ω—è–ª–∏—Å—å –≤ —Ä—è–¥ –ø–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –ø–µ—Ä–≤–∏—á–Ω—ã–µ `then` –æ—Ç—Ä–∞–±–æ—Ç–∞–ª–∏.

::ContentSvg{src="./assets/steps-3-2.svg" alt="–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –º–∏–∫—Ä–æ–∑–∞–¥–∞—á"}
::

## –ú–∏–∫—Ä–æ–∑–∞–¥–∞—á–∞, –≤–Ω—É—Ç—Ä–∏ –∫–æ—Ç–æ—Ä–æ–π –º–∞–∫—Ä–æ–∑–∞–¥–∞—á–∞
–î–∞–≤–∞–π—Ç–µ —Å–æ–∑–¥–∞–¥–∏–º –ø—Ä–æ–º–∏—Å, –≤–Ω—É—Ç—Ä–∏ –∫–æ—Ç–æ—Ä–æ–≥–æ –±—É–¥–µ—Ç –æ–±—ä—è–≤–ª—è—Ç—å—Å—è –º–∞–∫—Ä–æ–∑–∞–¥–∞—á–∞. –°–¥–µ–ª–∞–µ–º —ç—Ç–æ –æ–ø—è—Ç—å –∂–µ —Å –ø–æ–º–æ—â—å—é –ø—Ä–æ–º–∏—Å–æ–≤:

```js
setTimeout(() => console.log('Step 1: In setTimeout'));

new Promise(resolve => {
  console.log('Step 2: In promise constructor');
  resolve();
}).then(() => {
  console.log('Step 3: In then');
  setTimeout(() => console.log('Step 4: In setTimeout (inside of "then")'));
});

setTimeout(() => console.log('Step 5: In another setTimeout'));
```

```output
Step 2: In promise constructor
Step 3: In then
Step 1: In setTimeout
Step 5: In another setTimeout
Step 4: In setTimeout (inside of "then")
```

–¢—É—Ç –≤—Å–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç—Ä–∏–≤–∏–∞–ª—å–Ω–æ. –í–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–¥–Ω–æ–π –∏–∑ –º–∏–∫—Ä–æ–∑–∞–¥–∞—á –±—ã–ª–∞ –Ω–∞–π–¥–µ–Ω–∞ –º–∞–∫—Ä–æ–∑–∞–¥–∞—á–∞.
–≠—Ç–∞ –º–∞–∫—Ä–æ–∑–∞–¥–∞—á–∞ –±—ã–ª–∞ –ø–æ–º–µ—â–µ–Ω–∞ –≤ –∫–æ–Ω–µ—Ü –æ—á–µ—Ä–µ–¥–∏ –º–∞–∫—Ä–æ–∑–∞–¥–∞—á. –ü–æ—ç—Ç–æ–º—É `Step 4` –≤—ã–≤–µ–ª—Å—è –≤ –∫–æ–Ω—Ü–µ (–ø–æ—Ç–æ–º—É —á—Ç–æ –¥–∞–Ω–Ω–∞—è –º–∏–∫—Ä–æ–∑–∞–¥–∞—á–∞ –±—ã–ª–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–∑–∂–µ –≤—Å–µ—Ö).

## –ú–∞–∫—Ä–æ–∑–∞–¥–∞—á–∞ –≤–Ω—É—Ç—Ä–∏ –∫–æ—Ç–æ—Ä–æ–π –º–∏–∫—Ä–æ–∑–∞–¥–∞—á–∞

```js
setTimeout(() => console.log('Step 1: In setTimeout'));
setTimeout(() => {
  new Promise(resolve => {
    console.log('Step 2: In promise constructor (inside setTimeout)');
    resolve();
  }).then(() => console.log('Step 3: In then (inside setTimeout)'));
});

new Promise(resolve => {
  console.log('Step 4: In promise constructor');
  resolve();
}).then(() => {
  console.log('Step 5: In then');
});

setTimeout(() => console.log('Step 6: In another setTimeout'));
```

```output
Step 4: In promise constructor
Step 5: In then
Step 1: In setTimeout
Step 2: In promise constructor (inside setTimeout)
Step 3: In then (inside setTimeout)
Step 6: In another setTimeout
```

–î–∞–≤–∞–π—Ç–µ –≤—Å–ø–æ–º–Ω–∏–º —á—Ç–æ –º–∞–∫—Ä–æ–∑–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–æ –æ–¥–Ω–æ–π. –ü–µ—Ä–µ–¥ —Ç–µ–º –∫–∞–∫ –≤—ã–ø–æ–ª–Ω—è—Ç—å –∫–∞–∂–¥—É—é —Å–ª–µ–¥—É—é—â—É—é –∑–∞–¥–∞—á—É
Event Loop –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–µ—Ç –ª–∏ —É –Ω–∞—Å –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á –∏–∑ Call Stack, –∞ —Ç–∞–∫–∂–µ –Ω–µ—Ç –ª–∏ –º–∏–∫—Ä–æ–∑–∞–¥–∞—á.

–ö–∞–∫ —Ç–æ–ª—å–∫–æ –Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –∏ Call Stack –ø—É—Å—Ç–æ–π - –æ–Ω–∞ —Å—Ä–∞–∑—É –∂–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è. –í–æ—Ç –ø–æ—á–µ–º—É `Step 3` –≤—ã–ø–æ–ª–Ω–∏–ª—Å—è
—Å—Ä–∞–∑—É –∂–µ –ø–æ—Å–ª–µ `Step 2`.

::ContentSvg{src="./assets/steps-5.svg" alt="–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è –º–∏–∫—Ä–æ–∑–∞–¥–∞—á"}
::
